{# inicio card7 - Gerenciamento de Terrenos #}
<div class="dash-card dash-card-responsive-half">
    <h4>üå± Gerenciamento de Terrenos</h4>
    <p>Cadastre e acompanhe os seus terrenos e o cultivo principal em cada um.</p>

    <!-- Formul√°rio de Cria√ß√£o de Terreno -->
    <div class="terreno-form-container" id="terreno-create-form">
        <h5>Cadastrar Novo Terreno</h5>
        <!-- ATUALIZADO: A√ß√£o aponta para 'terreno_app:create_terreno' -->
        <form method="post" action="{% url 'terreno_app:create_terreno' %}">
            {% csrf_token %}
            <!-- Renderiza os campos do formul√°rio (incluindo state e city, que ser√£o preenchidos via JS) -->
            {% for field in terreno_form %}
                <p>
                    <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                    {{ field }}
                    {% if field.errors %}
                        <ul style="color: red; list-style: none; padding: 0; font-size: 0.9em;">
                            {% for error in field.errors %}<li>{{ error }}</li>{% endfor %}
                        </ul>
                    {% endif %}
                </p>
            {% endfor %}
            <button type="submit" class="edit-btn" style="width: 100%; margin-top: 10px;">Salvar Terreno</button>
        </form>
    </div>

    <h5 style="margin-top: 30px; border-bottom: 1px solid #eee; padding-bottom: 5px;">Seus Terrenos Atuais ({{ terrenos|length }})</h5>

    {% if terrenos %}
        <ul class="terreno-list">
            {% for terreno in terrenos %}
                <li class="terreno-item">
                    <div class="terreno-details">
                        <strong>{{ terreno.name }}</strong>
                        {# CORRE√á√ÉO: Usando m√©todos (que devem ser criados no modelo) para exibir o nome da Cidade/Estado, n√£o o campo inexistente 'cidade'. #}
                        <small>
                            | √Årea: **{{ terreno.area|default:"0"|floatformat:"2" }} {{ terreno.get_unit_display }}** | Localiza√ß√£o: {{ terreno.get_city_name|default:"N√£o informada" }} ({{ terreno.get_state_name|default:"UF" }})
                            | Cultivo: {{ terreno.cultura_atual|default:"N√£o definido" }}
                        </small>
                    </div>
                    <div class="terreno-actions">
                        <!-- ATUALIZADO: Link de Edi√ß√£o aponta para 'terreno_app:edit_terreno' -->
                        <a href="{% url 'terreno_app:edit_terreno' pk=terreno.pk %}" class="edit-btn">
                            Editar
                        </a>
                        <!-- ATUALIZADO: Formul√°rio de Exclus√£o aponta para 'terreno_app:delete_terreno' -->
                        <form method="post" action="{% url 'terreno_app:delete_terreno' pk=terreno.pk %}" style="display:inline;" onsubmit="return confirmDelete(event, '{{ terreno.name|escapejs }}')">
                            {% csrf_token %}
                            <button type="submit" class="delete-btn">Excluir</button>
                        </form>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p style="margin-top: 10px;">Voc√™ ainda n√£o tem terrenos cadastrados. Use o formul√°rio acima para adicionar o seu primeiro.</p>
    {% endif %}
</div>
{# fim card7 #}

<!-- Script B√°sico para Confirma√ß√£o de Exclus√£o -->
<script>
    // Fun√ß√£o para exibir um modal de confirma√ß√£o simples (substituindo o antigo alert/confirm)
    // ATEN√á√ÉO: Se voc√™ usa um sistema de modal global, adapte esta fun√ß√£o para us√°-lo.
    function confirmDelete(event, itemName) {
        const confirmed = window.confirm(`Tem certeza que deseja excluir o terreno '${itemName}'? Esta a√ß√£o n√£o pode ser desfeita.`);
        if (!confirmed) {
            event.preventDefault(); // Impede o envio do formul√°rio se o usu√°rio cancelar
        }
        return confirmed;
    }
</script>
