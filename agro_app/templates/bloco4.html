{% load humanize %}  {# ESTA LINHA √â NECESS√ÅRIA! Inclu√≠dos n√£o herdam loads do template pai. #}

{# inicio card6 #}
    <div class="dash-card dash-card-responsive-half">
        <h4>‚öôÔ∏è Sugest√µes de Plantio para {{ city_name|default:"sua Regi√£o" }}</h4>
        <p class="mb-4">Baseado no hist√≥rico de **Maior Valor Total (R$)** e **Melhor Pre√ßo por Quilo (R$/kg)** na sua cidade.</p>

        {# CORRE√á√ÉO: Verifica as vari√°veis que a view envia: suggestions_lucratividade e suggestions_preco #}
        {% if suggestions_lucratividade or suggestions_preco %}

            <!-- CORRE√á√ÉO DE RESPONSIVIDADE: -->
            <!-- Telas pequenas: Stacked (vertical) com espa√ßo vertical (space-y-4) -->
            <!-- Telas m√©dias (md) e maiores: Flex (horizontal) com espa√ßo horizontal (md:space-x-4) -->
            <div class="ranking-container space-y-4 md:flex md:space-x-4 md:space-y-0">

                {# BLOCO DE RANQUEAMENTO POR LUCRATIVIDADE (Valor Total) #}
                <!-- Telas pequenas: w-full (100%) / Telas m√©dias e maiores: md:w-1/2 (50%) -->
                <div class="w-full md:w-1/2">
                    <h5 class="text-sm font-semibold text-green-700 border-b pb-1 mb-2">üèÜ Maior Lucratividade (Valor Total)</h5>
                    <ul class="suggestion-list">
                        {# CORRE√á√ÉO: Itera sobre suggestions_lucratividade #}
                        {% for product in suggestions_lucratividade %}
                            <li class="suggestion-item rank-{{ forloop.counter }} flex justify-between items-center">
                                <span class="text-sm font-medium">
                                    <strong class="text-lg mr-1 text-green-600">{{ forloop.counter }}¬∫</strong> {{ product.name }}
                                </span>
                                <span class="text-sm text-gray-600 font-bold">
                                    {# Exibe o valor total (R$) #}
                                    R$ {{ product.valor|floatformat:"0"|intcomma }}
                                </span>
                            </li>
                        {% endfor %}
                        {% if not suggestions_lucratividade %}
                             <li class="text-xs text-gray-500 italic">Dados de lucratividade n√£o dispon√≠veis.</li>
                        {% endif %}
                    </ul>
                </div>

                {# BLOCO DE RANQUEAMENTO POR PRE√áO UNIT√ÅRIO (R$/kg) #}
                <!-- Telas pequenas: w-full (100%) / Telas m√©dias e maiores: md:w-1/2 (50%) -->
                <div class="w-full md:w-1/2">
                    <h5 class="text-sm font-semibold text-yellow-700 border-b pb-1 mb-2">üí∞ Melhor Pre√ßo por Quilo (R$/kg)</h5>
                    <ul class="suggestion-list">
                        {# CORRE√á√ÉO: Itera sobre suggestions_preco #}
                        {% for product in suggestions_preco %}
                             <li class="suggestion-item rank-{{ forloop.counter }} flex justify-between items-center">
                                <span class="text-sm font-medium">
                                    <strong class="text-lg mr-1 text-yellow-600">{{ forloop.counter }}¬∫</strong> {{ product.name }}
                                </span>
                                <span class="text-sm text-gray-600 font-bold">
                                    {# Exibe o pre√ßo por quilo (R$/kg) com 2 casas decimais #}
                                    R$ {{ product.preco_por_quilo|floatformat:"2" }}
                                </span>
                            </li>
                        {% endfor %}
                        {% if not suggestions_preco %}
                             <li class="text-xs text-gray-500 italic">Dados de pre√ßo n√£o dispon√≠veis.</li>
                        {% endif %}
                    </ul>
                </div>
            </div>

        {% else %}
            {# Fallback para quando n√£o h√° nenhum dado de ranqueamento #}
            {% if profile.city %}
                <p>N√£o foi poss√≠vel gerar sugest√µes com base nos dados hist√≥ricos da sua cidade. Certifique-se de que a cidade cadastrada possui dados de produ√ß√£o ou tente outra localiza√ß√£o.</p>
            {% else %}
                <p>Por favor, complete seu cadastro de localiza√ß√£o para receber as sugest√µes.</p>
            {% endif %}
        {% endif %}
    </div>
    {# fim card6 #}
