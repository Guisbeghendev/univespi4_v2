{% load humanize %}

{# in√≠cio card4 #}
<div class="dash-card">
    <h4 class="sub-title" style="font-size: 1.5em; text-align: left; margin-bottom: 10px;">‚öôÔ∏è Sugest√µes de Plantio para {{ city_name|default:"sua Regi√£o" }}</h4>
    <p>Baseado no hist√≥rico de **Maior Valor Total (R$)** e **Melhor Pre√ßo por Quilo (R$/kg)** na sua cidade.</p>

    {% if suggestions_lucratividade or suggestions_preco %}

        <div class="sugestion-container">

            {# BLOCO DE RANQUEAMENTO POR LUCRATIVIDADE (Valor Total) #}
            <div>
                <h5 style="color: #4CAF50; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px;">üèÜ Maior Lucratividade (Valor Total)</h5>
                <ul class="suggestion-list">
                    {% for product in suggestions_lucratividade %}
                        <li class="suggestion-item rank-{{ forloop.counter }}">
                            <span>
                                <strong style="font-size: 1.1em; margin-right: 5px; color: #2e7d32;">{{ forloop.counter }}¬∫</strong> {{ product.name }}
                            </span>
                            <span class="suggestion-score">
                                R$ {{ product.valor|floatformat:"0"|intcomma }}
                            </span>
                        </li>
                    {% endfor %}
                    {% if not suggestions_lucratividade %}
                        <li style="font-size: 0.9em; color: #666; font-style: italic;">Dados de lucratividade n√£o dispon√≠veis.</li>
                    {% endif %}
                </ul>
            </div>

            {# BLOCO DE RANQUEAMENTO POR PRE√áO UNIT√ÅRIO (R$/kg) #}
            <div>
                <h5 style="color: #FFD700; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px;">üí∞ Melhor Pre√ßo por Quilo (R$/kg)</h5>
                <ul class="suggestion-list">
                    {% for product in suggestions_preco %}
                        <li class="suggestion-item rank-{{ forloop.counter }}">
                            <span>
                                <strong style="font-size: 1.1em; margin-right: 5px; color: #FFD700;">{{ forloop.counter }}¬∫</strong> {{ product.name }}
                            </span>
                            <span class="suggestion-score">
                                R$ {{ product.preco_por_quilo|floatformat:"2" }}
                            </span>
                        </li>
                    {% endfor %}
                    {% if not suggestions_preco %}
                        <li style="font-size: 0.9em; color: #666; font-style: italic;">Dados de pre√ßo n√£o dispon√≠veis.</li>
                    {% endif %}
                </ul>
            </div>

        </div>

    {% else %}
        {# Fallback para quando n√£o h√° nenhum dado de ranqueamento #}
        {% if profile.city %}
            <p style="padding-top: 10px;">N√£o foi poss√≠vel gerar sugest√µes com base nos dados hist√≥ricos da sua cidade. Certifique-se de que a cidade cadastrada possui dados de produ√ß√£o ou tente outra localiza√ß√£o.</p>
        {% else %}
            <p style="padding-top: 10px;">Por favor, complete seu cadastro de localiza√ß√£o para receber as sugest√µes.</p>
        {% endif %}
    {% endif %}
</div>
{# fim card4 #}